
# Для запуска stroppy необходимо использовать команды, указанные в Makefile.

Назначение команд:

make all - собрать stroppy из исходных файлов

make clean - очистить данные в Postgresql

make postgres_pop - выполнить тест загрузки массива счетов в Postgresql, по умолчанию 5 тысяч счетов

make postgres_pay - выполнить тест выполнения транзакций переводов между счетами в Postgresql, по умолчанию 100 тысяч операций

make fdb_init - создать файл fdb.cluster в рабочей директории для подключения к FoundationDB

make fdb_pop - выполнить тест загрузки массива счетов в FoundationDB, по умолчанию 5 тысяч счетов

make fdb_pay - выполнить тест выполнения транзакций переводов между счетами в FoundationDB, по умолчанию 100 тысяч операций

Команда для развертывания кластера для тестирования в yandex cloud:

make deploy_yandex

# Предварительные условия перед построением проекта на macOS:

Перед выполнением команды make all необходимо:

Установить, если не установлены macports по инструкции по ссылке:

[MacPorts Quckstart](https://www.macports.org/install.php)

1. установить в систему библиотеку foundationdb, для чего выполнить команду port install foundationdb
2. добавить символические ссылки на каталоги включаемых файлов и библиотек в общесистемную директорию:
```
ln -s /opt/local/include/foundationdb /usr/local/include/foundationdb
ln -s /opt/local/lib/libfdb_c.dylib /usr/local/lib/libfdb_c.dylib
```

# Примечание:
При работе с Yandex.Cloud перед развертыванием кластера необходимо в директории benchmark/deploy/
выполнить команду для генерации ключей RSA, которые будут использоваться для доступа к кластеру:

ssh-keygen -q -t rsa -N '' -f id_rsa <<<y 2>&1 >/dev/null

# Важно!  

Yandex.Cloud не поддерживает наименование ключей, отличное от указанных в команде выше.  

При работе с Oracle.Cloud приватный ключ(поддерживаются PEM-ключи, RSA не поддерживается)  
необходимо получить через web-интерфейс Oracle.Cloud и положить его в директорию benchmark/deploy/ ,   
переименовав его в private_key.pem  

# Пример последовательности команд для тестирования Postgresql:

make all  
make clean  
make postgres_pop  
make postgres_pay  

# Пример последовательности команд для тестирования FoundationDB:

Примечание: 
1. Команда make all запускается один раз, т.е. если сначала было выполнено тестирование Postgresql, 
второй раз её выполнять нет необходимости. 
2. команда make fdb init также выполняется однократно, она создается файл fdb.cluster, который клиент FoundationDB использует 
подключения к БД. По умолчанию она заполняет файл атрибутами для подключения к контейнеру docker, поэтому, если БД установлена
локально или удаленно, необходимо внести изменения в этот файл. 

make all  
make fdb_init  
make fdb_pop  
make fdb_pay  
